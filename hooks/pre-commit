#!/bin/bash

# Pre-commit hook for OpenLanguage
# Runs formatting and tests before allowing commit

set -e

echo "Running pre-commit checks..."

echo "Preparing CMake build..."
cmake -B build -DCMAKE_BUILD_TYPE=Release

# Run formatter
echo "Formatting code..."
cmake --build build --target format

# Check if there are any formatting changes
if ! git diff --quiet; then
    echo "Code formatting changes detected. Please stage the formatted files and commit again."
    exit 1
fi

# Run tests
echo "Running tests..."
cmake --build build --target test

echo "Pre-commit checks passed!"
exit 0
